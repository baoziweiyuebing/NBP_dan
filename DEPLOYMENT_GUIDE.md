# NextBestPath å®æœºéƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

å°†NextBestPathä»ä»¿çœŸè¿ç§»åˆ°å®ä½“æœºå™¨äººï¼ˆUnitree Go2w + RealSense D435iï¼‰ï¼Œå®ç°å®¤å†…è‡ªä¸»æ¢ç´¢ã€‚

**æ ¸å¿ƒæ€æƒ³ï¼š** ç”¨æœ€çŸ­è·¯å¾„æ¢ç´¢æœ€å¤šåŒºåŸŸ

---

## ğŸ› ï¸ ç¡¬ä»¶å‡†å¤‡

- **ç›¸æœºï¼š** Intel RealSense D435iï¼ˆUSB 3.0è¿æ¥ï¼‰
- **æœºå™¨äººï¼š** Unitree Go2w å››è¶³æœºå™¨ç‹—ï¼ˆä»¥å¤ªç½‘è¿æ¥ï¼‰
- **è®¡ç®—æœºï¼š** å¸¦CUDA GPUçš„ç¬”è®°æœ¬/PCï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰

---

## ğŸ“¦ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5æ­¥ï¼‰

### 1. å®‰è£…åŸºç¡€ç¯å¢ƒ

```bash
# å…‹éš†å¹¶è¿›å…¥é¡¹ç›®
git clone https://github.com/shiyao-li/NextBestPath.git
cd NextBestPath

# åˆ›å»ºç¯å¢ƒ
conda env create -f environment.yml
conda activate exploration
```

### 2. å®‰è£…å®æœºä¾èµ–

```bash
# RealSense SDK
pip install pyrealsense2

# Unitree SDK
git clone https://github.com/unitreerobotics/unitree_sdk2_python.git
cd unitree_sdk2_python && pip install -e .
cd ..

# å…¶ä»–ä¾èµ–
pip install -r requirements_real_robot.txt
```

### 3. ä¸‹è½½æ¨¡å‹æƒé‡

ä»[Google Drive](https://drive.google.com/drive/folders/1jAEKrznbbZ5bwu39y0ah4pszMlTuVAfH)ä¸‹è½½ï¼Œæ”¾åˆ°`./weights/nbp/`

### 4. æµ‹è¯•ç¡¬ä»¶

```bash
# æµ‹è¯•ç›¸æœº
python real_camera_impl.py

# æµ‹è¯•ç¯å¢ƒ
python real_world_env.py
```

### 5. è¿è¡Œæ¢ç´¢

```bash
python test_real_robot.py \
    --nbp_weights ./weights/nbp/AiMDoom_simple_best_val.pth \
    --n_poses 10 \
    --max_velocity 0.2
```

---

## ğŸ“‚ æ–°å¢æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

#### 1. `real_camera_impl.py` - RealSenseç›¸æœºæ¥å£

**ä¸»è¦ç±»ï¼š`RealSenseCamera`**

| å‡½æ•° | åŠŸèƒ½ | è¿”å›å€¼ |
|-----|------|--------|
| `__init__()` | åˆå§‹åŒ–ç›¸æœºï¼Œé…ç½®RGBå’Œæ·±åº¦æµ | - |
| `capture_image()` | æ•è·RGBå›¾å’Œæ·±åº¦å›¾ | images(RGB), depth(æ·±åº¦) |
| `get_intrinsics()` | è·å–ç›¸æœºå†…å‚ | fx, fy, cx, cy |
| `compute_partial_point_cloud()` | ä»æ·±åº¦å›¾ç”Ÿæˆç‚¹äº‘ | ç‚¹äº‘åæ ‡, ç‚¹äº‘é¢œè‰² |
| `stop()` | åœæ­¢ç›¸æœº | - |

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from real_camera_impl import RealSenseCamera

# åˆå§‹åŒ–
camera = RealSenseCamera(width=640, height=480)

# æ•è·
images, depth = camera.capture_image()
# images: (1, H, W, 3) RGBå›¾ï¼ŒèŒƒå›´[0,1]
# depth: (1, H, W, 1) æ·±åº¦å›¾ï¼Œå•ä½ç±³ï¼Œæ— æ•ˆæ·±åº¦ä¸º0

# ç”Ÿæˆç‚¹äº‘
points, colors = camera.compute_partial_point_cloud(depth, images)
# points: (N, 3) ç›¸æœºåæ ‡ç³»ä¸‹çš„3Dç‚¹
# colors: (N, 3) RGBé¢œè‰²

camera.stop()
```

---

#### 2. `real_world_env.py` - æœºå™¨äººç¯å¢ƒç®¡ç†

**ä¸»è¦ç±»ï¼š`RealWorldEnvironment`**

æ•´åˆç›¸æœºå’Œæœºå™¨ç‹—ï¼Œæä¾›ç»Ÿä¸€æ¥å£ã€‚

| å‡½æ•° | åŠŸèƒ½ | è¿”å›å€¼ |
|-----|------|--------|
| `__init__()` | åˆå§‹åŒ–ç›¸æœºå’Œç¯å¢ƒ | - |
| `update_robot_pose_from_state()` | ä»æœºå™¨ç‹—çŠ¶æ€æ›´æ–°ä½å§¿ | - |
| `get_camera_pose()` | è·å–ç›¸æœºåœ¨ä¸–ç•Œåæ ‡ç³»çš„ä½å§¿ | R(æ—‹è½¬çŸ©é˜µ), T(ä½ç½®) |
| `capture_image_with_pose()` | æ•è·å›¾åƒ+ä½å§¿ | images, depth, R, T |
| `compute_partial_point_cloud_world()` | ç”Ÿæˆä¸–ç•Œåæ ‡ç³»ç‚¹äº‘ | ä¸–ç•Œåæ ‡ç‚¹äº‘, é¢œè‰² |
| `save_current_pose()` | ä¿å­˜å½“å‰ä½å§¿åˆ°å†å² | - |
| `reset_world_origin()` | é‡ç½®ä¸–ç•Œåæ ‡åŸç‚¹ | - |

**åæ ‡ç³»è½¬æ¢å…³ç³»ï¼š**
```
ç›¸æœºåæ ‡ç³» --[R,T]--> ä¸–ç•Œåæ ‡ç³»
    â†‘
    | (ç›¸æœºå›ºå®šåœ¨æœºå™¨äººä¸Šï¼Œåç§»é‡å¯é…ç½®)
æœºå™¨äººåæ ‡ç³»
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from real_world_env import RealWorldEnvironment

# åˆå§‹åŒ–
env = RealWorldEnvironment(
    camera_width=640,
    camera_height=480,
    camera_height_offset=0.3,  # ç›¸æœºé«˜åº¦ï¼ˆç±³ï¼‰
    camera_forward_offset=0.2   # ç›¸æœºå‰å‘åç§»ï¼ˆç±³ï¼‰
)

# æ•è·å›¾åƒå’Œä½å§¿
images, depth, R, T = env.capture_image_with_pose()
# R: (1, 3, 3) æ—‹è½¬çŸ©é˜µ
# T: (1, 3) ä¸–ç•Œåæ ‡ç³»ä½ç½®

# ç”Ÿæˆä¸–ç•Œåæ ‡ç³»ç‚¹äº‘
world_points, colors = env.compute_partial_point_cloud_world(depth, images, R, T)

env.stop()
```

---

#### 3. `Unigoal_Action_Mapping.py` - æœºå™¨ç‹—æ§åˆ¶

**ä¸»è¦åŠŸèƒ½ï¼š** å°†NBPè¾“å‡ºçš„ç›®æ ‡ä½å§¿è½¬æ¢ä¸ºæœºå™¨ç‹—é€Ÿåº¦æŒ‡ä»¤

| å‡½æ•° | åŠŸèƒ½ | å‚æ•° | è¿”å›å€¼ |
|-----|------|------|--------|
| `init_Agent()` | åˆå§‹åŒ–æœºå™¨ç‹—è¿æ¥ | ç½‘ç»œæ¥å£å | sport_client, çŠ¶æ€è®¢é˜…å™¨ |
| `get_state()` | è·å–æœºå™¨ç‹—å½“å‰çŠ¶æ€ | - | SportModeStateå¯¹è±¡ |
| `get_current_pose()` | ä»çŠ¶æ€æå–ä½å§¿ | state | {position, yaw} |
| `move_to_pose()` | ç§»åŠ¨åˆ°ç›®æ ‡ä½å§¿ | å½“å‰ä½å§¿, ç›®æ ‡ä½å§¿ | æˆåŠŸ/å¤±è´¥, è¯¯å·® |
| `move_along_path()` | æ²¿è·¯å¾„ç§»åŠ¨ | è·¯å¾„ç‚¹åˆ—è¡¨ | æˆåŠŸ/å¤±è´¥ |

**æ ¸å¿ƒå‡½æ•°ï¼š`move_to_pose()`**

åŠŸèƒ½ï¼šä½¿ç”¨PIDæ§åˆ¶å™¨å°†æœºå™¨ç‹—ä»å½“å‰ä½å§¿ç§»åŠ¨åˆ°ç›®æ ‡ä½å§¿

```python
def move_to_pose(current_pose, target_pose, sport_client,
                 position_tolerance=0.1,      # ä½ç½®å®¹å·®ï¼ˆç±³ï¼‰
                 yaw_tolerance=0.1,           # è§’åº¦å®¹å·®ï¼ˆå¼§åº¦ï¼‰
                 max_linear_velocity=0.3,     # æœ€å¤§çº¿é€Ÿåº¦
                 max_angular_velocity=0.5,    # æœ€å¤§è§’é€Ÿåº¦
                 timeout=30.0):               # è¶…æ—¶æ—¶é—´
```

**æ§åˆ¶ç­–ç•¥ï¼š**
1. å…ˆè½¬å‘ç›®æ ‡æ–¹å‘
2. å†å‰è¿›åˆ°ç›®æ ‡ä½ç½®
3. å®æ—¶åé¦ˆè°ƒæ•´

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from Unigoal_Action_Mapping import init_Agent, get_state, get_current_pose, move_to_pose

# åˆå§‹åŒ–
sport_client, _ = init_Agent(ifname="enx607d099f16d2")

# è·å–å½“å‰ä½å§¿
state = get_state()
current_pose = get_current_pose(state)
# current_pose = {'position': [x, y, z], 'yaw': å¼§åº¦}

# è®¾ç½®ç›®æ ‡
target_pose = {
    'position': np.array([1.0, 2.0, 0.0]),  # å‰è¿›1ç±³ï¼Œå·¦ç§»2ç±³
    'yaw': 0.5  # æ—‹è½¬0.5å¼§åº¦
}

# ç§»åŠ¨
success, error = move_to_pose(current_pose, target_pose, sport_client)
```

---

#### 4. `test_real_robot.py` - ä¸»æµ‹è¯•ç¨‹åº

**åŠŸèƒ½ï¼š** å®Œæ•´çš„å®æœºæ¢ç´¢æµç¨‹

**æ ¸å¿ƒæµç¨‹ï¼š**
```python
1. åˆå§‹åŒ–ç¯å¢ƒï¼ˆç›¸æœº+æœºå™¨äººï¼‰
2. åŠ è½½NBPæ¨¡å‹
3. For æ¯ä¸€æ­¥:
   a. æ•è·RGB+æ·±åº¦+ä½å§¿
   b. ç”Ÿæˆå¹¶ç´¯ç§¯ç‚¹äº‘
   c. å°†ç‚¹äº‘åˆ‡ç‰‡æˆ4ä¸ªé«˜åº¦å±‚
   d. æ·»åŠ è½¨è¿¹å†å²
   e. NBPé¢„æµ‹ä»·å€¼å›¾
   f. é€‰æ‹©æœ€ä½³ç›®æ ‡ä½ç½®
   g. æ§åˆ¶æœºå™¨ç‹—ç§»åŠ¨
   h. ä¿å­˜æ•°æ®
4. ä¿å­˜å®Œæ•´ç‚¹äº‘å’Œè½¨è¿¹
```

**å…³é”®å‚æ•°ï¼š**
```bash
--nbp_weights       # NBPæ¨¡å‹æƒé‡è·¯å¾„
--n_poses          # æ¢ç´¢æ­¥æ•°ï¼ˆæ¨è10-50ï¼‰
--max_velocity     # æœ€å¤§é€Ÿåº¦ï¼ˆæ¨è0.1-0.3 m/sï¼‰
--max_angular      # æœ€å¤§è§’é€Ÿåº¦ï¼ˆæ¨è0.2-0.5 rad/sï¼‰
--device           # PyTorchè®¾å¤‡ï¼ˆcuda:0æˆ–cpuï¼‰
--robot_interface  # æœºå™¨ç‹—ç½‘ç»œæ¥å£
--output_dir       # ç»“æœä¿å­˜ç›®å½•
```

**è¾“å‡ºæ–‡ä»¶ï¼š**
```
results/real_robot/run_TIMESTAMP/
â”œâ”€â”€ full_pc.ply       # å®Œæ•´ç‚¹äº‘
â”œâ”€â”€ partial_XXX.ply   # æ¯æ­¥çš„ç‚¹äº‘
â”œâ”€â”€ trajectory.ply    # è½¨è¿¹
â””â”€â”€ results.json      # å®Œæ•´æ•°æ®
```

---

#### 5. `openply.py` - ç‚¹äº‘å¯è§†åŒ–å·¥å…·

**åŠŸèƒ½ï¼š** ä½¿ç”¨Open3DæŸ¥çœ‹ç‚¹äº‘å’Œè½¨è¿¹

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹å®Œæ•´ç‚¹äº‘+è½¨è¿¹
python openply.py full_pc.ply --trajectory trajectory.ply

# ä»…æŸ¥çœ‹ç‚¹äº‘ä¿¡æ¯
python openply.py full_pc.ply --info

# æ¯”è¾ƒå¤šä¸ªç‚¹äº‘
python openply.py partial_000.ply partial_010.ply partial_020.ply --compare

# è°ƒæ•´ç‚¹å¤§å°
python openply.py full_pc.ply --point-size 3.0
```

**ä¸»è¦å‡½æ•°ï¼š**
| å‡½æ•° | åŠŸèƒ½ |
|-----|------|
| `load_ply_file()` | åŠ è½½PLYæ–‡ä»¶ |
| `visualize_ply_files()` | å¯è§†åŒ–ç‚¹äº‘å’Œè½¨è¿¹ |
| `compare_ply_files()` | æ¯”è¾ƒå¤šä¸ªç‚¹äº‘ |
| `get_point_cloud_info()` | æ˜¾ç¤ºç‚¹äº‘ç»Ÿè®¡ä¿¡æ¯ |

---

#### 6. `rviz_visualizer.py` - RVizå¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

**åŠŸèƒ½ï¼š** åœ¨RVizä¸­å®æ—¶æ˜¾ç¤ºè½¨è¿¹ï¼ˆéœ€è¦ROSï¼‰

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# ç”ŸæˆRVizé…ç½®
python rviz_visualizer.py --create-config

# å¯åŠ¨RViz
rviz -d nbp_visualization.rviz &

# å‘å¸ƒè½¨è¿¹
python rviz_visualizer.py results/real_robot/run_TIMESTAMP/
```

---

### ä¿®æ”¹çš„æ–‡ä»¶

#### `macarons/utility/macarons_utils.py`

**ä¿®æ”¹å†…å®¹ï¼š** `Camera.capture_image()`å‡½æ•°æ·»åŠ å®æœºæ”¯æŒ

**æ–°å¢å‚æ•°ï¼š** `real_camera_env=None`

```python
# ä»¿çœŸæ¨¡å¼ï¼ˆåŸæœ‰ï¼‰
images, depth = camera.capture_image(mesh)

# å®æœºæ¨¡å¼ï¼ˆæ–°å¢ï¼‰
images, depth = camera.capture_image(mesh, real_camera_env=env)
```

**åŸç†ï¼š**
- å¦‚æœ`real_camera_env`ä¸ºNone â†’ ä»¿çœŸæ¨¡å¼ï¼ˆæ¸²æŸ“meshï¼‰
- å¦‚æœæä¾›äº†`real_camera_env` â†’ å®æœºæ¨¡å¼ï¼ˆä»RealSenseè·å–ï¼‰

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### å®Œæ•´æµç¨‹ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆå§‹åŒ–                                         â”‚
â”‚    - å¯åŠ¨RealSenseç›¸æœº                            â”‚
â”‚    - è¿æ¥Unitree Go2w                            â”‚
â”‚    - åŠ è½½NBPæ¨¡å‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¢ç´¢å¾ªç¯ï¼ˆé‡å¤Næ¬¡ï¼‰                            â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ a. æ•è·æ•°æ®                                 â”‚ â”‚
â”‚  â”‚    - RGBå›¾åƒ                                â”‚ â”‚
â”‚  â”‚    - æ·±åº¦å›¾                                 â”‚ â”‚
â”‚  â”‚    - æœºå™¨äººä½å§¿                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                â”‚
â”‚                  â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ b. å¤„ç†ç‚¹äº‘                                 â”‚ â”‚
â”‚  â”‚    - æ·±åº¦è½¬3Dç‚¹äº‘                           â”‚ â”‚
â”‚  â”‚    - è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»                       â”‚ â”‚
â”‚  â”‚    - ç´¯ç§¯åˆ°full_pc                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                â”‚
â”‚                  â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ c. NBPè§„åˆ’                                  â”‚ â”‚
â”‚  â”‚    - ç‚¹äº‘åˆ‡ç‰‡ï¼ˆ4å±‚ï¼‰                        â”‚ â”‚
â”‚  â”‚    - æ·»åŠ è½¨è¿¹å†å²                           â”‚ â”‚
â”‚  â”‚    - NBPé¢„æµ‹ä»·å€¼å›¾                          â”‚ â”‚
â”‚  â”‚    - é€‰æ‹©æœ€ä½³ç›®æ ‡                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                â”‚
â”‚                  â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ d. æ§åˆ¶ç§»åŠ¨                                 â”‚ â”‚
â”‚  â”‚    - è®¡ç®—ç›®æ ‡ä½å§¿                           â”‚ â”‚
â”‚  â”‚    - move_to_pose()                         â”‚ â”‚
â”‚  â”‚    - æœºå™¨ç‹—ç§»åŠ¨                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¿å­˜ç»“æœ                                       â”‚
â”‚    - full_pc.plyï¼ˆå®Œæ•´ç‚¹äº‘ï¼‰                      â”‚
â”‚    - trajectory.plyï¼ˆè½¨è¿¹ï¼‰                       â”‚
â”‚    - results.jsonï¼ˆæ•°æ®ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘å›¾

```
RealSense D435i           Unitree Go2w
      â”‚                        â”‚
      â”‚ RGB+Depth             â”‚ Position+Yaw
      â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RealWorldEnvironment             â”‚
â”‚   - åæ ‡è½¬æ¢                        â”‚
â”‚   - ç‚¹äº‘ç”Ÿæˆ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ ä¸–ç•Œåæ ‡ç³»ç‚¹äº‘
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç‚¹äº‘å¤„ç†                          â”‚
â”‚   - Yè½´åˆ†4å±‚                        â”‚
â”‚   - æŠ•å½±åˆ°2Då›¾åƒ                    â”‚
â”‚   - æ·»åŠ è½¨è¿¹å†å²                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 5é€šé“å›¾åƒï¼ˆ4å±‚+è½¨è¿¹ï¼‰
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NBPç¥ç»ç½‘ç»œ                       â”‚
â”‚   - è¾“å…¥: (1, 5, 256, 256)         â”‚
â”‚   - è¾“å‡º1: ä»·å€¼å›¾ (1, 8, 64, 64)   â”‚
â”‚   - è¾“å‡º2: éšœç¢å›¾ (1, 1, 256, 256) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ é€‰æ‹©æœ€å¤§ä»·å€¼ä½ç½®
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿åŠ¨è§„åˆ’                          â”‚
â”‚   - åæ ‡è½¬æ¢                        â”‚
â”‚   - ç›®æ ‡ä½å§¿è®¡ç®—                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ ç›®æ ‡ä½å§¿
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   move_to_pose()                   â”‚
â”‚   - PIDæ§åˆ¶                         â”‚
â”‚   - é€Ÿåº¦æŒ‡ä»¤ (vx, vy, vyaw)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         Unitree Go2w ç§»åŠ¨
```

---

## âš™ï¸ å…³é”®å‚æ•°è¯´æ˜

### æ¢ç´¢å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | å»ºè®®èŒƒå›´ |
|-----|------|--------|------|---------|
| `n_poses` | int | 20 | æ¢ç´¢æ­¥æ•° | 5-50 |
| `max_linear_velocity` | float | 0.2 | æœ€å¤§çº¿é€Ÿåº¦(m/s) | 0.1-0.3 |
| `max_angular_velocity` | float | 0.3 | æœ€å¤§è§’é€Ÿåº¦(rad/s) | 0.2-0.5 |

### ç›¸æœºå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|--------|------|
| `camera_width` | int | 640 | å›¾åƒå®½åº¦ï¼ˆåƒç´ ï¼‰ |
| `camera_height` | int | 480 | å›¾åƒé«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| `camera_fps` | int | 30 | å¸§ç‡ |
| `gathering_factor` | float | 0.05 | ç‚¹äº‘é‡‡æ ·ç‡ï¼ˆ5%ï¼‰ |

### ç›¸æœºå®‰è£…åç§»

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|--------|------|
| `camera_height_offset` | 0.3ç±³ | ç›¸æœºç›¸å¯¹æœºå™¨äººåº•ç›˜é«˜åº¦ |
| `camera_forward_offset` | 0.2ç±³ | ç›¸æœºç›¸å¯¹æœºå™¨äººä¸­å¿ƒå‰å‘åç§» |

### æ§åˆ¶å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|--------|------|
| `position_tolerance` | 0.1ç±³ | ä½ç½®åˆ°è¾¾å®¹å·® |
| `yaw_tolerance` | 0.1å¼§åº¦ | è§’åº¦åˆ°è¾¾å®¹å·® |
| `control_frequency` | 20Hz | æ§åˆ¶é¢‘ç‡ |
| `timeout` | 30ç§’ | å•æ¬¡ç§»åŠ¨è¶…æ—¶ |

---

## ğŸ“Š å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: é¦–æ¬¡æµ‹è¯•ï¼ˆ5æ­¥ï¼Œä½é€Ÿï¼‰

```bash
python test_real_robot.py \
    --nbp_weights ./weights/nbp/AiMDoom_simple_best_val.pth \
    --n_poses 5 \
    --max_velocity 0.1 \
    --max_angular 0.2 \
    --output_dir ./results/first_test
```

**é¢„æœŸæ—¶é—´ï¼š** 5-10åˆ†é’Ÿ
**é¢„æœŸè¾“å‡ºï¼š** 5ä¸ªç‚¹äº‘æ–‡ä»¶ + å®Œæ•´ç‚¹äº‘ + è½¨è¿¹

### ç¤ºä¾‹2: å°æˆ¿é—´æ¢ç´¢ï¼ˆ15æ­¥ï¼‰

```bash
python test_real_robot.py \
    --nbp_weights ./weights/nbp/AiMDoom_simple_best_val.pth \
    --n_poses 15 \
    --max_velocity 0.15 \
    --max_angular 0.25 \
    --output_dir ./results/small_room
```

### ç¤ºä¾‹3: å¤§ç©ºé—´æ¢ç´¢ï¼ˆ30æ­¥ï¼‰

```bash
python test_real_robot.py \
    --nbp_weights ./weights/nbp/AiMDoom_normal_best_val.pth \
    --n_poses 30 \
    --max_velocity 0.25 \
    --max_angular 0.35 \
    --output_dir ./results/large_hall
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ç›¸æœºåˆå§‹åŒ–å¤±è´¥

```
Error: Failed to initialize RealSense camera
```

**è§£å†³ï¼š**
```bash
# æµ‹è¯•ç›¸æœº
realsense-viewer

# æ£€æŸ¥USBè¿æ¥
lsusb | grep Intel
```

### Q2: æœºå™¨ç‹—è¿æ¥å¤±è´¥

```
Error: Failed to initialize robot
```

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ç½‘ç»œæ¥å£
ifconfig

# æ›´æ–°æ¥å£å
python test_real_robot.py --robot_interface <ä½ çš„æ¥å£å>
```

### Q3: ç‚¹äº‘è´¨é‡å·®

**åŸå› ï¼š** å…‰ç…§ä¸å¥½ã€æ·±åº¦æ•°æ®å™ªå£°å¤§

**è§£å†³ï¼š**
- æ”¹å–„ç¯å¢ƒå…‰ç…§
- è°ƒæ•´`gathering_factor`ï¼ˆå¢å¤§è·å¾—æ›´å¤šç‚¹ï¼‰
- è°ƒæ•´æ·±åº¦æ»¤æ³¢å™¨å‚æ•°ï¼ˆåœ¨`real_camera_impl.py`ï¼‰

### Q4: æœºå™¨ç‹—ç§»åŠ¨ä¸å‡†

**åŸå› ï¼š** é‡Œç¨‹è®¡æ¼‚ç§»ã€å‚æ•°ä¸åˆé€‚

**è§£å†³ï¼š**
- é™ä½é€Ÿåº¦å‚æ•°
- è°ƒæ•´PIDå¢ç›Šï¼ˆåœ¨`Unigoal_Action_Mapping.py`ï¼‰
- ä½¿ç”¨æ›´çŸ­çš„æ¢ç´¢æ­¥æ•°

---

## ğŸ“ æ–‡ä»¶æ€»è§ˆ

```
NextBestPath-main/
â”œâ”€â”€ real_camera_impl.py          # RealSenseæ¥å£
â”œâ”€â”€ real_world_env.py             # ç¯å¢ƒç®¡ç†
â”œâ”€â”€ test_real_robot.py            # ä¸»ç¨‹åº
â”œâ”€â”€ Unigoal_Action_Mapping.py    # æœºå™¨ç‹—æ§åˆ¶
â”œâ”€â”€ openply.py                    # ç‚¹äº‘æŸ¥çœ‹
â”œâ”€â”€ rviz_visualizer.py            # RVizå¯è§†åŒ–
â”œâ”€â”€ requirements_real_robot.txt   # ä¾èµ–æ¸…å•
â”œâ”€â”€ DEPLOYMENT_GUIDE.md          # æœ¬æ–‡æ¡£
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ éœ€æ±‚.md                       # åŸå§‹éœ€æ±‚
â”œâ”€â”€ macarons/                     # 3Dé‡å»ºæ¨¡å—
â”œâ”€â”€ next_best_path/              # NBPè§„åˆ’æ¨¡å—
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶
â”œâ”€â”€ weights/                      # æ¨¡å‹æƒé‡
â””â”€â”€ results/                      # è¿è¡Œç»“æœ
```

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] Condaç¯å¢ƒå·²åˆ›å»º
- [ ] RealSense SDKå·²å®‰è£…å¹¶æµ‹è¯•
- [ ] Unitree SDKå·²å®‰è£…
- [ ] NBPæƒé‡å·²ä¸‹è½½
- [ ] ç›¸æœºèƒ½æ­£å¸¸æ•è·å›¾åƒ
- [ ] æœºå™¨ç‹—èƒ½è¿æ¥å¹¶è·å–çŠ¶æ€
- [ ] æµ‹è¯•ç¯å¢ƒå·²æ¸…ç©ºï¼ˆ3x3ç±³ç©ºé—´ï¼‰
- [ ] å‡†å¤‡å¥½ç´§æ€¥åœæ­¢ï¼ˆCtrl+Cï¼‰

å…¨éƒ¨å®Œæˆåå³å¯å¼€å§‹æµ‹è¯•ï¼

---

**ç¥æ¢ç´¢é¡ºåˆ©ï¼** ğŸš€
